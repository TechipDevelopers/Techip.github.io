<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Techip Admin Connection Test</title>
  <style>body{font-family:system-ui,Roboto,Arial;max-width:900px;margin:20px auto;padding:18px}</style>
</head>
<body>
  <h1>Techip Admin — Connection Test</h1>
  <p id="status">Starting…</p>
  <pre id="out" style="background:#f7f7f7;padding:12px;border:1px solid #eee;white-space:pre-wrap;"></pre>

  <script type="module">
    // CONFIG: set your project values here
    const SUPABASE_URL = 'https://cnwerkocgdhimiwuawiv.supabase.co'
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNud2Vya29jZ2RoaW1pd3Vhd2l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwOTMwMjAsImV4cCI6MjA3NzY2OTAyMH0.X0ewxmFBh2ofhIQGPgDucJk9pQJylXDoLTerxYgrouw' // ← paste your anon/public key here

    const out = document.getElementById('out')
    const statusEl = document.getElementById('status')
    function log(...args){ console.log(...args); out.textContent += args.map(a => (typeof a === 'object' ? JSON.stringify(a,null,2) : String(a))).join(' ') + '\\n' }

    // visible early check
    try { alert('Test script loaded — check console and the page for results') } catch (e) {}

    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: false } })

    ;(async function testConnection(){
      statusEl.textContent = 'Testing connection to Supabase…'
      try {
        log('Trying to select 1 row from public.devices')
        const { data, error } = await supabase.from('devices').select('id, name, owner, created_at').limit(1)
        if (error) {
          log('ERROR', error)
          statusEl.textContent = 'Connection FAILED: see details below'
          alert('Connection test failed: ' + (error.message || JSON.stringify(error)))
          return
        }
        log('OK — query result:', data)
        statusEl.textContent = 'Connection OK — received data. See console/out below.'
        alert('Supabase connection OK')
      } catch (e) {
        log('EXCEPTION', e)
        statusEl.textContent = 'Exception occurred — see console/out below'
        alert('Exception during connection test (see console)')
      }
    })()
  </script>
</body>
</html>
